[settings]
experimental = true

[tools]
"rust" = { version = "1.91.1", profile = "default" }
"hk" = "latest"
"pkl" = "latest"
"cargo:scraps" = "0.27.2"
"npm:markdownlint-cli2" = "latest"

[hooks]
postinstall = "hk install --mise"

[tasks."cargo:build"]
description = "Build the project with cargo"
run = "cargo build --verbose --workspace"

[tasks."cargo:test"]
description = "Run all tests with cargo"
run = "cargo test --verbose --workspace"

[tasks."cargo:fmt"]
description = "Check code formatting with rustfmt"
run = "cargo fmt --all -- --check"

[tasks."cargo:fmt-fix"]
description = "Fix code formatting with rustfmt"
run = "cargo fmt --all"

[tasks."cargo:clippy"]
description = "Run clippy linter"
run = "cargo clippy --all-targets --all-features"

[tasks."cargo:quality"]
description = "Run pre-commit quality checks (build, test, fmt, clippy)"
depends = ["cargo:build", "cargo:test", "cargo:fmt", "cargo:clippy"]
run = "echo 'âœ… All quality checks passed!'"

[tasks."cargo:coverage"]
description = "Run code coverage analysis with tarpaulin"
run = "mise exec cargo:cargo-tarpaulin -- cargo tarpaulin --verbose --all-features --workspace --timeout 120 --exclude-files 'target/*'"

[tasks."e2e:test"]
description = "Run E2E tests with Playwright"
dir = "tests/e2e"
run = "npm install && npx playwright test"

[tasks."docs:build"]
description = "Build documentation with scraps"
run = "scraps build"

[tasks."docs:serve"]
description = "Serve documentation locally with scraps"
run = "scraps serve"

[tasks."docs:lint"]
description = "Lint markdown files in docs directory with markdownlint-cli2"
run = "markdownlint-cli2 'docs/**/*.md'"

[tasks."docs:lint-fix"]
description = "Auto-fix markdown files in docs directory with markdownlint-cli2"
run = "markdownlint-cli2 --fix 'docs/**/*.md'"
